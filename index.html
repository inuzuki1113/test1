<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>力学的エネルギー保存の法則について大学教授が調べてみたブログ。</title>

<!-- Google AdSense スクリプト -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9307386569150647"
        crossorigin="anonymous"></script>

<style>
  body { font-family: Arial,sans-serif; background:#111; color:#fff; margin:10px; text-align:center;}
  input, button { font-size:1rem; padding:8px; border-radius:4px; border:none; }
  input { width: 80%; max-width:400px; }
  button { background:#cc0000; color:#fff; cursor:pointer; }
  button:hover { background:#ff3333; }
  .video {
    margin:20px auto;
    max-width:560px;
    width:90vw;
    cursor: pointer;
  }
  .video img {
    border-radius:8px;
    width: 120px;
    height: 90px;
    object-fit: cover;
    vertical-align: middle;
  }
  .video h3 {
    display: inline-block;
    max-width: 400px;
    text-align: left;
    font-size: 1rem;
    margin-left: 10px;
    vertical-align: middle;
    color: #eee;
  }
  iframe {
    width: 100%;
    height: 315px;
    border-radius: 6px;
    border: none;
  }
  @media(max-width:400px) {
    iframe { height: 200px; }
  }
  .ad-container {
    margin: 20px auto;
    max-width: 560px;
  }
</style>
</head>
<body>

<h1>YouTube検索</h1>

<!-- 広告ユニット -->
<div id="ads" class="ad-container">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-9307386569150647"
       data-ad-slot="1234567890"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<input id="query" placeholder="検索ワード" onkeydown="if(event.key==='Enter'){search();}" />
<button onclick="search()">検索</button>
<div id="results"></div>

<script>
const API_KEY = "AIzaSyDnBoaP5dygiMotDopdVGzzFyctc_eBSXU";

function escapeHtml(t){
  return t.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

// 検索処理
function search(){
  // 動画プレイヤーを閉じて広告表示
  closeVideo();

  const q = document.getElementById("query").value.trim();
  if(!q){ alert("検索ワードを入力してください"); return; }

  fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=15&q=${encodeURIComponent(q)}&key=${API_KEY}`)
  .then(res => res.json())
  .then(data => {
    const resultsDiv = document.getElementById("results");
    if(!data.items || data.items.length === 0){
      resultsDiv.innerHTML = "<p>検索結果がありません。</p>";
      return;
    }
    let html = "";
    data.items.forEach(item => {
      const videoId = item.id.videoId;
      const title = escapeHtml(item.snippet.title);
      const thumb = item.snippet.thumbnails.default.url; 
      html += `
        <div class="video" onclick="showVideo('${videoId}', this)" tabindex="0" role="button" aria-pressed="false">
          <img src="${thumb}" alt="${title}" loading="lazy" width="120" height="90" />
          <h3>${title}</h3>
        </div>
      `;
    });
    resultsDiv.innerHTML = html;
  })
  .catch(err => alert("エラー: " + err));
}

// 動画再生処理
function showVideo(videoId, container){
  // 広告非表示
  const adsDiv = document.getElementById("ads");
  if(adsDiv) adsDiv.style.display = "none";

  container.innerHTML = `
    <iframe
      src="https://www.youtube.com/embed/${videoId}"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
      title="YouTube動画プレイヤー"
    ></iframe>
  `;
}

// 動画を閉じて広告を表示
function closeVideo(){
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";  // 検索結果をクリア

  const adsDiv = document.getElementById("ads");
  if(adsDiv) adsDiv.style.display = "block";  // 広告表示
}
</script>

</body>
</html>
